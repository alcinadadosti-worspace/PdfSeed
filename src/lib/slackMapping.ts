/**
 * Mapeamento fixo de nomes para Slack IDs
 * Adicione novos funcionários aqui no formato:
 * 'NOME COMPLETO': 'SLACK_ID'
 */
export const slackIdMap: Record<string, string> = {
  'ALBERTO LUIZ MARINHO BATISTA': 'U07KXEJU338',
  'ALYNI MAYARA FARIAS DA SILVA SANTOS': 'U081N2ZCK7Z',
  'AMANDA SANTOS COSTA': 'U07Q9HE3KGA',
  'ANA CLARA DE MATOS CHAGAS': 'U08F9KK0AAG',
  'ANA LUIZA DOS SANTOS': 'U08ERHMN6F9',
  'ANA PAULA AMARAL SANTOS ISMERIM': 'U087E6YNPRD',
  'ANDERSON ROSALVO ROCHA DOS SANTOS': 'U08EFRBASGJ',
  'ANE CAROLINE PEREIRA MARTER': 'U0A2PUWCUKS',
  'ANNY KAROLINE ANDRADE SANTOS': 'U08JFCGBFSA',
  'BRUNA CANDIDO DE LIMA': 'U088MU33XRC',
  'BRUNA RAYANE OLIVEIRA DOS SANTOS': 'U08NLNHF29G',
  'CAIQUE DOS SANTOS DA SILVA': 'U089NSW1BDG',
  'CAMILLA EMANUELLE LOPES DE ALMEIDA': 'U0939HA46LW',
  'CAMILLE KAUANE DA SILVA NUNES': 'U09JGAFFZB6',
  'CARLOS EDUARDO SILVA DE OLIVEIRA': 'U0895CZ8HU7',
  'CLAUDIO BISPO DOS SANTOS': 'U08EHG788DV',
  'CRISTIELLE PEREIRA LIMA DA SILVA': 'U087Z7M1TA5',
  'DANIELLE DOS SANTOS SILVA': 'U0929MZMW5C',
  'DANRLEY FIRMINO DOS SANTOS': 'U08EYMYMXNW',
  'DAVID DA SILVA BENTO': 'U08NERQKFD4',
  'DEISE GISLAINE SILVA VITOR': 'U092FQKNFPB',
  'EDNA LOPES DA SILVA': 'U08NCQMJCMQ',
  'ELIENE DA SILVA SANTOS': 'U087P8JF97F',
  'EMANOELLE FEITOSA VIEIRA SANTOS': 'U08NTGXEK26',
  'ERICK CAFÉ SANTOS JÚNIOR': 'U07KPE840MD',
  'GABRIELLE VITORIA DOS SANTOS': 'U09ED6DM61G',
  'GESSICA APARECIDA DOS SANTOS': 'U09G04R3CNP',
  'GESSYCA NAYARA ROCHA SANTOS': 'U08JJH9BWP5',
  'GISELLE DOS SANTOS ROBERTO': 'U08P5GH6C3Z',
  'HUGO CASTRO LOPES': 'U0A3P2QB5P0',
  'ISLA GABRIELA DE AZEVEDO SANTOS': 'U094W9F4ACA',
  'JOAO ANTONIO TAVARES SANTOS': 'U07LP4JSN9K',
  'JONATHAN HENRIQUE DA CONCEIÇÃO SILVA': 'U07L4D3EWJW',
  'JORDELLE MEYGRE COSTA DE OLIVEIRA': 'U088986S1L0',
  'JOSIMARA FERREIRA MONTEIRO': 'U08PZTY2G0Y',
  'JOSÉ FERNANDO DOS SANTOS SANTANA RAMOS': 'U07LGG4RPK3',
  'JOYCE CASSIMIRO SOUTO': 'U08NT4ZLKDG',
  'JOÃO RICARDO DANTAS ALBUQUERQUE': 'U09DHA4MV52',
  'JOÃO VICTOR SANTOS DA SILVA': 'U08762E1PMM',
  'JULIANA OLIVEIRA CAVALCANTE': 'U0A7AVC5ZSN',
  'JULIENE BEZERRA': 'U08PER1QM2N',
  'KAMILLA SANTOS DA SILVA': 'U091WKY7V6X',
  'KARINE CELESTINO EVANGELISTA DOS SANTOS': 'U09B6LQ3FFY',
  'KAUANNE IWASHITA DA SILVA': 'U0875QNU02K',
  'KEMILLY RAFAELLY SOUZA SILVA': 'U087HDEARA9',
  'LAÍS MANUELLE SANTOS PEREIRA': 'U08UMBX0CP4',
  'LEIDIANE SOUZA': 'U07KX76F7D4',
  'LETICIA SEIXAS SANTOS': 'U08JJ6JMH50',
  'LETÍCIA SOARES BELO': 'U08K69RC01H',
  'LIANDA MELINDA SANTOS CALIXTO': 'U09AYV61119',
  'LUAN SANTOS DE OLIVEIRA': 'U087M32A18B',
  'LUCIANO TORRES': 'U08PPAAH5PT',
  'LUCIENE DA SILVA NASCIMENTO': 'U0AA4R2LSUS',
  'LUCRÉCIA SEVERO FERREIRA': 'U093NHTLU3F',
  'LUDMYLLA WOLPERT MELO': 'U08H0PHPAMC',
  'LUIZ FELLIPE GUEDES SANTOS SILVA': 'U08E4LNLG06',
  'LUIZ HENRIQUE MARTINS TAVARES': 'U07K7G5N0DB',
  'LUÍS HENRIQUE BATISTA DOS SANTOS': 'U097B39GTMG',
  'MARCIO ALIF SANTOS SILVA': 'U08QP0KFL15',
  'MARIA NOBRE FARIAS DE FRANÇA': 'U082F9GGMSM',
  'MARIA TACIANE PEREIRA BARBOSA': 'U07L6EAUS75',
  'MARIA TATIANE BASTO CARDOSO': 'U09C5DPU8E6',
  'MARIA TATIANE OLIVEIRA SANTOS': 'U087HG1B4DB',
  'MARIA VICTORIA SOUZA ARAUJO FERRO': 'U08EZUH7X1C',
  'MARIANE SANTOS SOUSA': 'U088B372R40',
  'MARYANNA FRANCIELLY TRAJANO DA SILVA': 'U09ED214T6W',
  'MICHAELL JEAN NUNES DE CARVALHO': 'U07P692F1FB',
  'MILLENA STHEFANY DOS SANTOS CRUZ': 'U08NLQK5PEJ',
  'NATALI DE SOUZA GONZAGA': 'U08M7D0EVR9',
  'NATHALIA VIEIRA LIMA': 'U08JJ7VF0N6',
  'PAULO CESAR DA SILVA SANTOS JUNIOR': 'U08EB943ZCJ',
  'PEDRO LUCAS ROCHA DA FONSECA': 'U09BMRBFRM0',
  'RAFAELA ALVES MENDES': 'U07KP9J5BLP',
  'RAQUELE FRAGOSO DA SILVA': 'U0A0D0J2E31',
  'RAVY THIAGO VIEIRA DA SILVA': 'U07Q8NT7J1Y',
  'ROBÉRIA GILO DA SILVA': 'U08B1MQJL3C',
  'RODRIGO AUGUSTO TEIXEIRA DOS SANTOS': 'U0922F5KB7U',
  'ROMULO JOSE SANTOS LISBOA': 'U07LSKN7SNL',
  'ROSILENE MARTINS DA SILVA': 'U0A1VJ2Q4R0',
  'SABRINA DOMINGOS SANTOS': 'U08F7PSCPK6',
  'SAMYRA ANCHIETA BISPO': 'U09EGC0GKN0',
  'SANDRA DA CONCEIÇÃO FREITAS': 'U0A1P79UK0T',
  'SUZANA MARTINS TAVARES': 'U09F9LWM6MC',
  'THALITA RUANNA SANTOS PEREIRA': 'U0A1E5S092B',
  'THALYS GOMES DOS SANTOS': 'U08E8GH19TP',
  'THAMIRYS SILVESTRINI MORALES': 'U08N6EGUZ8B',
  'THAYANE MAYARA DOS SANTOS': 'U08B2NHAH8C',
  'TOMÁS AZEVEDO SANTOS': 'U081ZP68CA1',
  'VALESCA MEIRELLE BEZERRA VITÓRIA': 'U087M7GCNMC',
  'YASMIM DA ROCHA BEZERRA BARBOSA': 'U08F8T8SMNE',
  'YASMIN ABILIA FERRO DA SILVA': 'U0A5YLESW1E',
  'YURI CASTRO GOMES': 'U094A8J5R2L',
}

/**
 * Normaliza o nome para comparação (remove acentos, uppercase)
 */
function normalizeName(name: string): string {
  return name
    .toUpperCase()
    .normalize('NFD')
    .replace(/[\u0300-\u036f]/g, '')
    .replace(/\s+/g, ' ')
    .trim()
}

/**
 * Calcula a distância de Levenshtein entre duas strings
 */
function levenshteinDistance(a: string, b: string): number {
  const matrix: number[][] = []

  for (let i = 0; i <= b.length; i++) {
    matrix[i] = [i]
  }
  for (let j = 0; j <= a.length; j++) {
    matrix[0][j] = j
  }

  for (let i = 1; i <= b.length; i++) {
    for (let j = 1; j <= a.length; j++) {
      if (b.charAt(i - 1) === a.charAt(j - 1)) {
        matrix[i][j] = matrix[i - 1][j - 1]
      } else {
        matrix[i][j] = Math.min(
          matrix[i - 1][j - 1] + 1,
          matrix[i][j - 1] + 1,
          matrix[i - 1][j] + 1
        )
      }
    }
  }

  return matrix[b.length][a.length]
}

/**
 * Calcula a similaridade entre dois nomes (0 a 100)
 */
function calculateSimilarity(name1: string, name2: string): number {
  const n1 = normalizeName(name1)
  const n2 = normalizeName(name2)
  const maxLen = Math.max(n1.length, n2.length)
  if (maxLen === 0) return 100
  const distance = levenshteinDistance(n1, n2)
  return Math.round((1 - distance / maxLen) * 100)
}

export interface SimilarName {
  name: string
  slackId: string
  similarity: number
}

/**
 * Busca nomes similares quando não encontra match exato
 * Retorna até 5 sugestões com similaridade >= 50%
 */
export function getSimilarNames(inputName: string, limit = 5): SimilarName[] {
  const results: SimilarName[] = []

  for (const [name, slackId] of Object.entries(slackIdMap)) {
    const similarity = calculateSimilarity(inputName, name)
    if (similarity >= 50) {
      results.push({ name, slackId, similarity })
    }
  }

  return results
    .sort((a, b) => b.similarity - a.similarity)
    .slice(0, limit)
}

/**
 * Retorna todos os nomes cadastrados no sistema
 */
export function getAllNames(): { name: string; slackId: string }[] {
  return Object.entries(slackIdMap).map(([name, slackId]) => ({ name, slackId }))
}

/**
 * Busca o Slack ID pelo nome do funcionário
 */
export function getSlackIdByName(name: string): string | undefined {
  const normalizedInput = normalizeName(name)

  // Primeiro tenta match exato
  for (const [mapName, slackId] of Object.entries(slackIdMap)) {
    if (normalizeName(mapName) === normalizedInput) {
      return slackId
    }
  }

  // Depois tenta match parcial (um contém o outro)
  for (const [mapName, slackId] of Object.entries(slackIdMap)) {
    const normalizedMapName = normalizeName(mapName)
    if (normalizedInput.includes(normalizedMapName) || normalizedMapName.includes(normalizedInput)) {
      return slackId
    }
  }

  return undefined
}
